import React from "react"
import { cn } from "@/lib/utils"
import { fontClassMap } from "@/const/fontMap"
import { Facebook, Github, Globe, Instagram, Linkedin, Twitter, Youtube } from "lucide-react"

interface SocialLink {
  id: string | number
  platform: string
  url: string
  isVisible?: boolean
}

interface ListSocialLinksProps {
  user: {
    profile?: {
      socialLinks?: SocialLink[]
    }
  }
  template: {
    fonts: { heading?: string; body?: string }
    colors: { text: string; secondary: string; accent: string }
  }
}

const getBrandColor = (platformKey: string) => {
  const lowerPlatform = platformKey.toLowerCase().replace(/\s+/g, "")
  const colorMap: Record<string, string> = {
    facebook: "#1877F2",
    instagram: "#E4405F",
    twitter: "#1DA1F2",
    linkedin: "#0A66C2",
    github: "#181717",
    youtube: "#FF0000",
    tiktok: "#000000",
    whatsapp: "#25D366",
    viber: "#7360F2",
    line: "#00B900",
    telegram: "#26A5E4",
    kakao: "#FEE500",
    wechat: "#07C160",
  }

  for (const [key, color] of Object.entries(colorMap)) {
    if (lowerPlatform.includes(key)) {
      return color
    }
  }

  return "#6B7280"
}

const getSocialIconWhite = (platformKey: string) => {
  const lowerPlatform = platformKey.toLowerCase().replace(/\s+/g, "")

  if (lowerPlatform.includes("whatsapp") || lowerPlatform.includes("whats")) {
    return (
      <svg className="w-6 h-6" viewBox="0 0 24 24" fill="white">
        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
      </svg>
    )
  }

  if (lowerPlatform.includes("viber")) {
    return (
      <svg className="w-6 h-6" viewBox="0 0 24 24" fill="white">
        <path d="M11.398.002C9.473.028 5.331.344 3.014 2.467 1.294 4.177.693 6.698.623 9.82c-.06 3.11-.13 8.95 5.5 10.541v2.42s-.038.97.602 1.17c.79.25 1.24-.499 1.99-1.299l1.4-1.58c3.85.32 6.8-.419 7.14-.529.78-.25 5.181-.811 5.901-6.652.74-6.031-.36-9.831-2.34-11.551l-.01-.002c-.6-.55-3-2.3-8.37-2.32 0 0-.396-.025-1.038-.016zm.067 1.697c.545-.003.88.02.88.02 4.54.01 6.711 1.38 7.221 1.84 1.67 1.429 2.528 4.856 1.9 9.892-.6 4.88-4.17 5.19-4.83 5.4-.28.09-2.88.73-6.152.52 0 0-2.439 2.941-3.199 3.701-.12.13-.26.17-.35.15-.13-.03-.17-.19-.16-.41l.02-4.019c-4.771-1.32-4.491-6.302-4.441-8.902.06-2.6.55-4.732 2-6.172 1.957-1.77 5.475-2.01 7.11-2.02zm.36 2.6a.299.299 0 00-.3.299.3.3 0 00.3.3 5.631 5.631 0 014.03 1.59 5.402 5.402 0 011.75 3.87.3.3 0 00.3.3.3.3 0 00.3-.3 5.966 5.966 0 00-1.936-4.269 6.222 6.222 0 00-4.445-1.79zm-3.954.69a.955.955 0 00-.615.12h-.012c-.41.24-.788.54-1.148.93-.27.27-.44.606-.359 1.01.21 1.06.77 2.14 1.379 3.08a13.467 13.467 0 003.831 4.36c.09.06.18.13.26.19.94.75 1.791 1.24 2.532 1.639.27.14.5.25.69.35a2.03 2.03 0 001.102.24 1.99 1.99 0 001.162-.35c.4-.3.73-.63 1.051-1.05.219-.28.189-.61-.04-.83l-2.081-1.58c-.24-.18-.56-.17-.779.02l-.899.779a.711.711 0 01-.749.14c-.619-.24-1.419-.72-2.379-1.68-.959-.959-1.439-1.759-1.679-2.379a.653.653 0 01.13-.749l.779-.899c.2-.22.21-.539.03-.779L8.18 5.577c-.12-.16-.29-.25-.47-.25zm3.653.19a.3.3 0 00-.3.3.3.3 0 00.3.299c.77 0 1.5.299 2.05.841.55.54.85 1.27.85 2.039a.3.3 0 00.3.3.3.3 0 00.3-.3c0-.899-.36-1.759-1-2.399-.64-.64-1.5-1-2.4-1h-.1zm.29 1.8a.3.3 0 00-.3.3.3.3 0 00.3.3c.32 0 .63.13.85.35.23.22.35.53.35.85a.3.3 0 00.3.299.3.3 0 00.3-.3c0-.48-.2-.94-.54-1.279a1.8 1.8 0 00-1.26-.53z" />
      </svg>
    )
  }

  if (lowerPlatform.includes("line")) {
    return (
      <svg className="w-6 h-6" viewBox="0 0 24 24" fill="white">
        <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314" />
      </svg>
    )
  }

  if (lowerPlatform.includes("telegram")) {
    return (
      <svg className="w-6 h-6" viewBox="0 0 24 24" fill="white">
        <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
      </svg>
    )
  }

  if (lowerPlatform.includes("kakao")) {
    return (
      <svg className="w-6 h-6" viewBox="0 0 24 24" fill="#3C1E1E">
        <path d="M12 0C5.373 0 0 4.372 0 9.778c0 3.43 2.282 6.446 5.738 8.158-.243.897-.94 3.524-1.068 4.057-.152.635.233.627.492.456.205-.136 3.21-2.13 4.592-3.046.812.114 1.644.174 2.494.174 6.627 0 12-4.372 12-9.778C24 4.372 18.627 0 12 0z" />
      </svg>
    )
  }

  if (lowerPlatform.includes("wechat") || lowerPlatform.includes("we")) {
    return (
      <svg className="w-6 h-6" viewBox="0 0 24 24" fill="white">
        <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178 1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826 0 1.622-.12 2.361-.336a.722.722 0 0 1 .598.082l1.584.926a.272.272 0 0 0 .14.047c.134 0 .24-.111.24-.247 0-.06-.023-.12-.038-.177l-.327-1.233a.582.582 0 0 1 .18-.556c1.527-1.123 2.5-2.784 2.5-4.627 0-3.51-3.473-6.298-7.824-6.298l-.238.003zm-2.391 1.645a.971.971 0 0 1 .971.969.971.971 0 0 1-.971.969.971.971 0 0 1-.97-.969.971.971 0 0 1 .97-.969zm4.782 0a.971.971 0 0 1 .971.969.971.971 0 0 1-.971.969.971.971 0 0 1-.971-.969.971.971 0 0 1 .971-.969z" />
      </svg>
    )
  }

  if (lowerPlatform.includes("tiktok")) {
    return (
      <svg className="w-6 h-6" viewBox="0 0 24 24" fill="white">
        <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z" />
      </svg>
    )
  }

  const iconMap: Record<string, React.ReactNode> = {
    facebook: <Facebook size={24} color="white" />,
    instagram: <Instagram size={24} color="white" />,
    twitter: <Twitter size={24} color="white" />,
    linkedin: <Linkedin size={24} color="white" />,
    github: <Github size={24} color="white" />,
    youtube: <Youtube size={24} color="white" />,
  }

  return iconMap[lowerPlatform] || <Globe size={24} color="white" />
}

export const GridSocialLinks: React.FC<ListSocialLinksProps> = ({ user, template,}) => {
  const links = user?.profile?.socialLinks?.filter((link) => link.isVisible)

  if (!links || links.length === 0) return null

  return (
    <div className="px-6 pb-6">
      <h2
        className={cn(fontClassMap[template?.fonts?.heading || ""], "text-sm font-semibold uppercase mb-3 tracking-wide text-foreground")}
        style={{
          fontFamily: template?.fonts?.heading,
          color: template?.colors?.text,
        }}
      >
        Connect with me
      </h2>

      <div className="overflow-x-auto -mx-6 px-6 scrollbar-hide">
        <div className="flex gap-2 sm:gap-3 min-w-max pb-1">
          {links.map((link) => {
            const platformKey = link.platform?.toLowerCase()
            const brandColor = getBrandColor(platformKey)

            return (
              <a
                key={link.id}
                href={link.url}
                target="_blank"
                rel="noreferrer"
                className={cn(
                  fontClassMap[template.fonts.body || ""],
                  "flex items-center justify-center rounded-xl w-10 h-10 sm:w-12 sm:h-12 flex-shrink-0",
                  "hover:scale-110 transition-all hover:opacity-80 shadow-md active:scale-95",
                )}
                style={{ backgroundColor: brandColor }}
                title={link.platform}
              >
                <div className="scale-[0.7] sm:scale-75">{getSocialIconWhite(platformKey)}</div>
              </a>
            )
          })}
        </div>
      </div>
    </div>
  )
}
